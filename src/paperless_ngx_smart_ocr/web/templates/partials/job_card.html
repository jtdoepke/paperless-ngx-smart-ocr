{% set terminal = job.status in ["completed", "failed", "cancelled"] %}
{% set status_colors = {
  "pending": "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",
  "running": "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",
  "completed": "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",
  "failed": "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",
  "cancelled": "bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",
} %}

<div id="job-{{ job.id }}"
     class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"
     {% if not terminal %}
     hx-get="/jobs/{{ job.id }}"
     hx-trigger="every 2s"
     hx-target="this"
     hx-swap="outerHTML"
     {% endif %}>
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-3">
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ status_colors.get(job.status, 'bg-gray-100 text-gray-800') }}">
        {{ job.status }}
      </span>
      <span class="text-sm text-gray-900 dark:text-gray-100">{{ job.name }}</span>
    </div>
    {% if not terminal %}
    <button hx-post="/jobs/{{ job.id }}/cancel"
            hx-target="#job-{{ job.id }}"
            hx-swap="outerHTML"
            class="text-xs text-red-600 dark:text-red-400 hover:underline">
      Cancel
    </button>
    {% endif %}
  </div>

  <div class="mt-2 text-xs text-gray-500 dark:text-gray-400 space-y-1">
    {% if job.document_id %}
    <p>Document:
      <a href="/documents/{{ job.document_id }}" class="text-blue-600 dark:text-blue-400 hover:underline">
        #{{ job.document_id }}
      </a>
    </p>
    {% endif %}
    {% if job.duration_seconds is not none %}
    <p>Duration: {{ "%.1f" | format(job.duration_seconds) }}s</p>
    {% endif %}
    {% if job.result and not job.result.success %}
    <p class="text-red-600 dark:text-red-400">Error: {{ job.result.error_message }}</p>
    {% endif %}
  </div>
</div>
